---
layout: post
title: 推荐引擎和广告检索引擎的异同
category: architecture
---

# 背景

之前做海外短视频的推荐引擎，后面转做竞价广告的检索引擎（再后面转做品牌广告），所以一直想写下这两者：推进引擎/竞价广告检索引擎的异同。


# 流程概览


## 推荐场景流程概览：

![推荐流程](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-5.png)


## 广告场景流程概览

![广告流程](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-6.png)


# 物料/来源/入实时流

当时从推荐团队到广告团队的一个原因，就是两者业务逻辑是相似。

都是将物料从召回、过滤、打分、排序、选择(渲染)，这样的流程下发到下游，下游再进行曝光、点击、转化等回流数据到后端。

### 物料量级
从物料量上来讲，我经历的两个团队的物料量是不在一个量级的，推荐的物料量要远远大于广告创意。视频的物料池包括UGC，PGC视频等应该有几十亿之多。广告的物料库不到千万级，如果是某一个时刻能够进行投放的物料，大概只有数万量级。

当然不同的广告团队，业务场景会有很大的不同，不过这相对符合直观的认知，一个平台的内容应该远远高于在这个平台进行投放的广告的。

### 物料来源
从物料的来源的说，推荐的内容来自于用户上传、达人(签约用户)生产，或者从爬虫得到的网络资源。内容质量参差不齐，而且五花八门，所以会经过机神、多层人工审核、复审、打标等等流程。

![推荐物料来源1](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-1.png)

但是广告创意就会对内容的把控明确得多，广告主上传的创意绝大部分是符合进行投放广告位的要求的，比如图片/视频的宽高/码率等，如果出现了这样的情况，基本在广告创意阶段就会在创建阶段就会拦截，返回给客户不合规的具体情况；以及广告内容也是基本满足要求(很少出现涉黄涉政等不合规的情况)，同时在进行投放的时候，客户也能够主动选择定向、行业等信息，一定程度来补充物料信息，在通过人工审核等基本就能够投放要求。

![广告物料来源](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-3.png)

### 物料下发

1，推荐场景

推荐的物料来源从五花八门，所以会经过层层审核。因为推荐场景更多的是关注的物料本身，而且物料的分发和广告场景有很大的不同，接近于高分者得(当然也会有用户兴趣ee等场景，所以会让低分物料下发)。

![推荐物料下发](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-2.png)

物料入库随即就会进行审核打标，使物料获得基本信息；然后进行物料的探索，一般来说会进行多轮的探索（但是在某些不太精细的场景也只有一轮）。

如果给足了一定的探索机会(一般来说是曝光额度)，物料没有达到预期的指标，如ctr,cvr等等，物料就会进入物料库，再下一轮索引构建的时候通过其他方式才有可能下发；而达到预期指标的物料，会进入推荐的常规池或者热播池，属于是相对精品的内容，可以分发到用户侧，提升用户的指标vv，ts等。另外提一下，探索视频往往是降指标的，所以一般也不会给新用户或者易流失用户下发探索视频。

其实热播视频，也会经历几个热播池，最后来到高热池。此时往往会进入到运营干预阶段，给物料降权，加权，或者进行内容运营（热搜，话题，造势）等等，将运营获取得到的信息再进入feed流分发，同时内容运营也会在其他的流量入口分发流量。

2，广告场景

对于广告场景来说，一般不会经过那么多轮的审核。在广告创意完成内容审核之后，就会进入创意的下发池。

广告相对推进，它更关注的是广告主的利益，所以首先就会满足一些订单合同上约定的内容，比如创意投放的时间/地域/特殊定向等，其次在完成了EE之后（积累一定的创意信息，便于模型计算），创意的模型质量打分(如ctr)不是很高，在某些情况也会进行投放，尽管这样会伤害到用户体验。

最明显的就是品牌广告中PDB类型的订单，不过在竞价广告中也会存在这样的情况，由于最后的竞价bid有广告出价这个因子，所以对于出价高的创意，自然最后得分就可能更高，就更可能投放。

然后，是创意的分发会进行费用的扣减，所以当费用撞线的时候，也就会停止创意的分发。即使创意热度再高，质量再好，也不会再进行分发。

另外，在大部分情况广告主希望的是创意进行平滑的投放，不是在某一个很短的时间就把预算花完，所以会有很多对创意维度的频控策略。推荐则是某一个内容爆火之后就会迅速蹿升，甚至后面会有运营在造势。

![广告物料下发](https://blogcdn.qihope.com/github-blog-pic/2022-03-24-what-is-diff-between-recommend-and-ad-4.png)

<br>

# 实时流程

待续..
